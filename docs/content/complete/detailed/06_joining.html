<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Joining Data Together – Advanced R for Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Advanced R for Data Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#determining-what-kind-of-join-to-do" id="toc-determining-what-kind-of-join-to-do" class="nav-link active" data-scroll-target="#determining-what-kind-of-join-to-do">Determining what kind of join to do</a>
  <ul class="collapse">
  <li><a href="#checking-the-uniqueness-of-the-key-id-variables" id="toc-checking-the-uniqueness-of-the-key-id-variables" class="nav-link" data-scroll-target="#checking-the-uniqueness-of-the-key-id-variables">Checking the uniqueness of the key ID variables</a></li>
  </ul></li>
  <li><a href="#joining-demographics-and-labs" id="toc-joining-demographics-and-labs" class="nav-link" data-scroll-target="#joining-demographics-and-labs">Joining demographics and labs</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Joining Data Together</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This lesson introduces techniques for “joining” multiple data tables together using a “key” variable that serves to identify the individual “observational units” in the data. In the NHANES data, each observational unit is an individual respondent of the survey.</p>
<p>A really helpful resource for learning about joins is the <a href="https://r4ds.had.co.nz/index.html">R for Data Science</a> book (specifically the chapter about <a href="https://r4ds.had.co.nz/relational-data.html">“Relational Data”</a>).</p>
<p>At the end of this lesson we will have created a <em>single</em> data frame that contains the information from both the <code>demographics</code> data and the urine albumin and creatinine <code>labs</code> data that we load in below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>demographics <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/demographics.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 10175 Columns: 19
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (5): interview_examination, gender, race, marital_status, pregnant
dbl (9): respondent_id, age_years, age_months_sc_0_2yr, six_month_period, ag...
lgl (5): served_active_duty_us, served_active_duty_foreign, born_usa, citize...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/urine_albumin_creatinine.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 41455 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): lab
dbl (2): respondent_id, measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<section id="determining-what-kind-of-join-to-do" class="level2">
<h2 class="anchored" data-anchor-id="determining-what-kind-of-join-to-do">Determining what kind of join to do</h2>
<p>There are four kinds of joins that you might want to use for combining two tables into a single table:</p>
<ul>
<li><p>An <strong>inner join</strong>, which will keep only the data for the observational units that appear in both tables</p></li>
<li><p>A <strong>left join</strong>, which will keep all of the data for the observational units in the first (left) table, and will add missing values when there is no available data in the second table.</p></li>
<li><p>A <strong>right join</strong>, which will keep all of the data for the observational units in the second (right) table, and will add missing values when there is no available data in the first table.</p></li>
<li><p>A <strong>full join</strong>, which will keep all of the data for the observational units in both the first (left) table, and will add missing values when there is no available data in the other table.</p></li>
</ul>
<p>The kind of join that you will implement will depend on what you want to use your joined data for.</p>
<p>If you only want to keep observational units that have <em>complete</em> data (i.e., data available in both tables), then you will want to perform an <em>inner join</em>, but if you don’t want to discard observational that are missing from one of the tables, you will want to perform a <em>full join</em>.</p>
<p>Identifying the overlap between the two tables can help determine which type of join makes sense.</p>
<p>So let’s ask the question of <em>Are there any observations in the demographics table that do not appear in the labs table?</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of people in demographics who are also in labs</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">unique</span>(demographics<span class="sc">$</span>respondent_id) <span class="sc">%in%</span> <span class="fu">unique</span>(labs<span class="sc">$</span>respondent_id)) <span class="sc">/</span> <span class="fu">n_distinct</span>(demographics<span class="sc">$</span>respondent_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8148403</code></pre>
</div>
</div>
<p>The calculation above shows that around 81% of observations in the demographics table have available labs data.</p>
<p>We can also ask the converse question of <em>Are there any observations in the labs table that do not appear in the demographics table?</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of people in labs who are also in demographics</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">unique</span>(labs<span class="sc">$</span>respondent_id) <span class="sc">%in%</span> <span class="fu">unique</span>(demographics<span class="sc">$</span>respondent_id)) <span class="sc">/</span> <span class="fu">n_distinct</span>(labs<span class="sc">$</span>respondent_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>The calculation above shows that 100% of observations in the labs table have available demographics data.</p>
<p>This means that all of the people with labs data appear in the demographics data. Which, if our “left” table is demographics, and our “right” table is labs, means that an <em>inner join will be the same as a full join</em>. It also means that a <em>full join will be the same as a left join</em>.</p>
<section id="checking-the-uniqueness-of-the-key-id-variables" class="level3">
<h3 class="anchored" data-anchor-id="checking-the-uniqueness-of-the-key-id-variables">Checking the uniqueness of the key ID variables</h3>
<p>It is also helpful to determine whether the key ID values are unique in each table. There are lots of ways to do this, one of which is using the <code>identical()</code> function to ask whether the <code>unique()</code> version of the <code>respondent_id</code> column is equal to the non-<code>unique()</code> version.</p>
<p>Below, we see that the <code>respondent_id</code> column is indeed unique for <code>demographics</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># are the respondent ID values in demographics unique?</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">unique</span>(demographics<span class="sc">$</span>respondent_id), demographics<span class="sc">$</span>respondent_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>But not for <code>labs</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># are the respondent ID values in labs unique?</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">unique</span>(labs<span class="sc">$</span>respondent_id), labs<span class="sc">$</span>respondent_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
</section>
</section>
<section id="joining-demographics-and-labs" class="level2">
<h2 class="anchored" data-anchor-id="joining-demographics-and-labs">Joining demographics and labs</h2>
<p>Our two options for to join demographics (left) and labs (right) are:</p>
<ul>
<li><p>An inner or right join will only keep the 81% of people in demographics who have available labs data</p></li>
<li><p><strong>A left or full join will keep all people in demographics data, and join missing values for those who don’t have labs data available</strong></p></li>
</ul>
<p>Since we don’t want to discard any data, we will choose the latter, a left/full join.</p>
<p>The following two pieces of code, one using <code>left_join()</code> and the other using <code>full_join()</code> are equivalent for this problem:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">left_join</span>(demographics, labs, <span class="at">by =</span> <span class="st">"respondent_id"</span>), <span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 43,339 × 21
   respondent_id interview_examination   gender age_years age_months_sc_0_2yr
           &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;      &lt;dbl&gt;               &lt;dbl&gt;
 1         73557 both interview and exam male          69                  NA
 2         73557 both interview and exam male          69                  NA
 3         73557 both interview and exam male          69                  NA
 4         73557 both interview and exam male          69                  NA
 5         73557 both interview and exam male          69                  NA
 6         73558 both interview and exam male          54                  NA
 7         73558 both interview and exam male          54                  NA
 8         73558 both interview and exam male          54                  NA
 9         73558 both interview and exam male          54                  NA
10         73558 both interview and exam male          54                  NA
   race  six_month_period age_months_ex_0_19yr served_active_duty_us
   &lt;chr&gt;            &lt;dbl&gt;                &lt;dbl&gt; &lt;lgl&gt;                
 1 black                1                   NA TRUE                 
 2 black                1                   NA TRUE                 
 3 black                1                   NA TRUE                 
 4 black                1                   NA TRUE                 
 5 black                1                   NA TRUE                 
 6 white                1                   NA FALSE                
 7 white                1                   NA FALSE                
 8 white                1                   NA FALSE                
 9 white                1                   NA FALSE                
10 white                1                   NA FALSE                
   served_active_duty_foreign born_usa citizen_usa time_in_us education_youth
   &lt;lgl&gt;                      &lt;lgl&gt;    &lt;lgl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
 1 TRUE                       TRUE     TRUE                NA              NA
 2 TRUE                       TRUE     TRUE                NA              NA
 3 TRUE                       TRUE     TRUE                NA              NA
 4 TRUE                       TRUE     TRUE                NA              NA
 5 TRUE                       TRUE     TRUE                NA              NA
 6 NA                         TRUE     TRUE                NA              NA
 7 NA                         TRUE     TRUE                NA              NA
 8 NA                         TRUE     TRUE                NA              NA
 9 NA                         TRUE     TRUE                NA              NA
10 NA                         TRUE     TRUE                NA              NA
   education marital_status pregnant language_english household_income
       &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    &lt;lgl&gt;                       &lt;dbl&gt;
 1         3 separated      &lt;NA&gt;     TRUE                        17500
 2         3 separated      &lt;NA&gt;     TRUE                        17500
 3         3 separated      &lt;NA&gt;     TRUE                        17500
 4         3 separated      &lt;NA&gt;     TRUE                        17500
 5         3 separated      &lt;NA&gt;     TRUE                        17500
 6         3 married        &lt;NA&gt;     TRUE                        40000
 7         3 married        &lt;NA&gt;     TRUE                        40000
 8         3 married        &lt;NA&gt;     TRUE                        40000
 9         3 married        &lt;NA&gt;     TRUE                        40000
10         3 married        &lt;NA&gt;     TRUE                        40000
   lab                         measurement
   &lt;chr&gt;                             &lt;dbl&gt;
 1 ur_albumin_ug_ml                    4.3
 2 ur_albumin_mg_l                     4.3
 3 ur_creatinine_mg_dl                39  
 4 ur_creatinine_umol_l             3448. 
 5 ur_albumin_creatinine_ratio        11.0
 6 ur_albumin_ug_ml                  153  
 7 ur_albumin_mg_l                   153  
 8 ur_creatinine_mg_dl                50  
 9 ur_creatinine_umol_l             4420  
10 ur_albumin_creatinine_ratio       306  
# ℹ 43,329 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">full_join</span>(demographics, labs, <span class="at">by =</span> <span class="st">"respondent_id"</span>), <span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 43,339 × 21
   respondent_id interview_examination   gender age_years age_months_sc_0_2yr
           &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;      &lt;dbl&gt;               &lt;dbl&gt;
 1         73557 both interview and exam male          69                  NA
 2         73557 both interview and exam male          69                  NA
 3         73557 both interview and exam male          69                  NA
 4         73557 both interview and exam male          69                  NA
 5         73557 both interview and exam male          69                  NA
 6         73558 both interview and exam male          54                  NA
 7         73558 both interview and exam male          54                  NA
 8         73558 both interview and exam male          54                  NA
 9         73558 both interview and exam male          54                  NA
10         73558 both interview and exam male          54                  NA
   race  six_month_period age_months_ex_0_19yr served_active_duty_us
   &lt;chr&gt;            &lt;dbl&gt;                &lt;dbl&gt; &lt;lgl&gt;                
 1 black                1                   NA TRUE                 
 2 black                1                   NA TRUE                 
 3 black                1                   NA TRUE                 
 4 black                1                   NA TRUE                 
 5 black                1                   NA TRUE                 
 6 white                1                   NA FALSE                
 7 white                1                   NA FALSE                
 8 white                1                   NA FALSE                
 9 white                1                   NA FALSE                
10 white                1                   NA FALSE                
   served_active_duty_foreign born_usa citizen_usa time_in_us education_youth
   &lt;lgl&gt;                      &lt;lgl&gt;    &lt;lgl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
 1 TRUE                       TRUE     TRUE                NA              NA
 2 TRUE                       TRUE     TRUE                NA              NA
 3 TRUE                       TRUE     TRUE                NA              NA
 4 TRUE                       TRUE     TRUE                NA              NA
 5 TRUE                       TRUE     TRUE                NA              NA
 6 NA                         TRUE     TRUE                NA              NA
 7 NA                         TRUE     TRUE                NA              NA
 8 NA                         TRUE     TRUE                NA              NA
 9 NA                         TRUE     TRUE                NA              NA
10 NA                         TRUE     TRUE                NA              NA
   education marital_status pregnant language_english household_income
       &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    &lt;lgl&gt;                       &lt;dbl&gt;
 1         3 separated      &lt;NA&gt;     TRUE                        17500
 2         3 separated      &lt;NA&gt;     TRUE                        17500
 3         3 separated      &lt;NA&gt;     TRUE                        17500
 4         3 separated      &lt;NA&gt;     TRUE                        17500
 5         3 separated      &lt;NA&gt;     TRUE                        17500
 6         3 married        &lt;NA&gt;     TRUE                        40000
 7         3 married        &lt;NA&gt;     TRUE                        40000
 8         3 married        &lt;NA&gt;     TRUE                        40000
 9         3 married        &lt;NA&gt;     TRUE                        40000
10         3 married        &lt;NA&gt;     TRUE                        40000
   lab                         measurement
   &lt;chr&gt;                             &lt;dbl&gt;
 1 ur_albumin_ug_ml                    4.3
 2 ur_albumin_mg_l                     4.3
 3 ur_creatinine_mg_dl                39  
 4 ur_creatinine_umol_l             3448. 
 5 ur_albumin_creatinine_ratio        11.0
 6 ur_albumin_ug_ml                  153  
 7 ur_albumin_mg_l                   153  
 8 ur_creatinine_mg_dl                50  
 9 ur_creatinine_umol_l             4420  
10 ur_albumin_creatinine_ratio       306  
# ℹ 43,329 more rows</code></pre>
</div>
</div>
<p>However, notice that the observations in demographics that have labs observations have all been <em>duplicated</em> to match the number of rows in the labs data for each respondent. There are now many more rows in our joined data than we had in our demographics data, which is <em>not</em> what we want!</p>
<p>An important lesson is learned here: <strong>if your key ID variable has repeated values, your joined data will too</strong>.</p>
<p><strong>A good check after completing a join is to make sure that the number of rows in the resulting joined data matches what you expect</strong></p>
<p>Therefore, to ensure that we have just one row per observational unit (i.e., per <code>respondent_id</code> value), we need to join the wide-format <code>labs_wide</code> data instead of the long-format <code>labs</code> data.</p>
<p>Below, we compute the wide-format labs data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>labs_wide <span class="ot">&lt;-</span> labs <span class="sc">|&gt;</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"lab"</span>, <span class="at">values_from =</span> <span class="st">"measurement"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>labs_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,291 × 6
   respondent_id ur_albumin_ug_ml ur_albumin_mg_l ur_creatinine_mg_dl
           &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;               &lt;dbl&gt;
 1         73557              4.3             4.3                  39
 2         73558            153             153                    50
 3         73559             11.9            11.9                 113
 4         73560             16              16                    76
 5         73561            255             255                   147
 6         73562            123             123                    74
 7         73564             19              19                   242
 8         73566              1.3             1.3                  18
 9         73567             35              35                   215
10         73568             25              25                    31
# ℹ 8,281 more rows
# ℹ 2 more variables: ur_creatinine_umol_l &lt;dbl&gt;,
#   ur_albumin_creatinine_ratio &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Then we can see that joining this wide version of the labs data onto the demographics data with a <code>left_join()</code> yields a joined dataset with all of the <code>demographics</code> and <code>labs_wide</code> columns, and the number of rows matches the original <code>demographics</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">left_join</span>(demographics, labs_wide, <span class="at">by =</span> <span class="st">"respondent_id"</span>), <span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,175 × 24
   respondent_id interview_examination   gender age_years age_months_sc_0_2yr
           &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;      &lt;dbl&gt;               &lt;dbl&gt;
 1         73557 both interview and exam male          69                  NA
 2         73558 both interview and exam male          54                  NA
 3         73559 both interview and exam male          72                  NA
 4         73560 both interview and exam male           9                  NA
 5         73561 both interview and exam female        73                  NA
 6         73562 both interview and exam male          56                  NA
 7         73563 both interview and exam male           0                   5
 8         73564 both interview and exam female        61                  NA
 9         73565 interview only          male          42                  NA
10         73566 both interview and exam female        56                  NA
   race             six_month_period age_months_ex_0_19yr served_active_duty_us
   &lt;chr&gt;                       &lt;dbl&gt;                &lt;dbl&gt; &lt;lgl&gt;                
 1 black                           1                   NA TRUE                 
 2 white                           1                   NA FALSE                
 3 white                           2                   NA TRUE                 
 4 white                           1                  119 NA                   
 5 white                           1                   NA FALSE                
 6 mexican american                1                   NA TRUE                 
 7 white                           2                    6 NA                   
 8 white                           2                   NA FALSE                
 9 other hispanic                 NA                   NA FALSE                
10 white                           1                   NA FALSE                
   served_active_duty_foreign born_usa citizen_usa time_in_us education_youth
   &lt;lgl&gt;                      &lt;lgl&gt;    &lt;lgl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
 1 TRUE                       TRUE     TRUE                NA              NA
 2 NA                         TRUE     TRUE                NA              NA
 3 TRUE                       TRUE     TRUE                NA              NA
 4 NA                         TRUE     TRUE                NA               3
 5 NA                         TRUE     TRUE                NA              NA
 6 FALSE                      TRUE     TRUE                NA              NA
 7 NA                         TRUE     TRUE                NA              NA
 8 NA                         TRUE     TRUE                NA              NA
 9 NA                         TRUE     TRUE                NA              NA
10 NA                         TRUE     TRUE                NA              NA
   education marital_status pregnant language_english household_income
       &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    &lt;lgl&gt;                       &lt;dbl&gt;
 1         3 separated      &lt;NA&gt;     TRUE                        17500
 2         3 married        &lt;NA&gt;     TRUE                        40000
 3         4 married        &lt;NA&gt;     TRUE                        70000
 4        NA &lt;NA&gt;           &lt;NA&gt;     TRUE                        60000
 5         5 married        &lt;NA&gt;     TRUE                       100000
 6         4 divorced       &lt;NA&gt;     TRUE                        60000
 7        NA &lt;NA&gt;           &lt;NA&gt;     TRUE                       100000
 8         5 widowed        &lt;NA&gt;     TRUE                        70000
 9         3 married        &lt;NA&gt;     TRUE                       100000
10         3 divorced       &lt;NA&gt;     TRUE                        17500
   ur_albumin_ug_ml ur_albumin_mg_l ur_creatinine_mg_dl ur_creatinine_umol_l
              &lt;dbl&gt;           &lt;dbl&gt;               &lt;dbl&gt;                &lt;dbl&gt;
 1              4.3             4.3                  39                3448.
 2            153             153                    50                4420 
 3             11.9            11.9                 113                9989.
 4             16              16                    76                6718.
 5            255             255                   147               12995.
 6            123             123                    74                6542.
 7             NA              NA                    NA                  NA 
 8             19              19                   242               21393.
 9             NA              NA                    NA                  NA 
10              1.3             1.3                  18                1591.
   ur_albumin_creatinine_ratio
                         &lt;dbl&gt;
 1                       11.0 
 2                      306   
 3                       10.5 
 4                       21.0 
 5                      173.  
 6                      166.  
 7                       NA   
 8                        7.85
 9                       NA   
10                        7.22
# ℹ 10,165 more rows</code></pre>
</div>
</div>
</section>
<section id="exercise" class="level2">
<h2 class="anchored" data-anchor-id="exercise">Exercise</h2>
<p>How many rows would you expect an inner join of <code>demographics</code> and <code>labs_wide</code> to have? Check your answer by conducting the join using <code>inner_join()</code></p>
<p>The number of rows should match the <em>intersection</em> of the two datasets. Since all people in <code>labs_wide</code> are also in <code>demographics</code>, the join will have the same number of rows in <code>labs_wide</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(labs_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8291</code></pre>
</div>
</div>
<p>The join can be conducted using <code>inner_join()</code> and notice that the number of rows matches <code>labs_wide</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(demographics, labs_wide, <span class="at">by =</span> <span class="st">"respondent_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,291 × 24
   respondent_id interview_examination   gender age_years age_months_sc_0_2yr
           &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;      &lt;dbl&gt;               &lt;dbl&gt;
 1         73557 both interview and exam male          69                  NA
 2         73558 both interview and exam male          54                  NA
 3         73559 both interview and exam male          72                  NA
 4         73560 both interview and exam male           9                  NA
 5         73561 both interview and exam female        73                  NA
 6         73562 both interview and exam male          56                  NA
 7         73564 both interview and exam female        61                  NA
 8         73566 both interview and exam female        56                  NA
 9         73567 both interview and exam male          65                  NA
10         73568 both interview and exam female        26                  NA
# ℹ 8,281 more rows
# ℹ 19 more variables: race &lt;chr&gt;, six_month_period &lt;dbl&gt;,
#   age_months_ex_0_19yr &lt;dbl&gt;, served_active_duty_us &lt;lgl&gt;,
#   served_active_duty_foreign &lt;lgl&gt;, born_usa &lt;lgl&gt;, citizen_usa &lt;lgl&gt;,
#   time_in_us &lt;dbl&gt;, education_youth &lt;dbl&gt;, education &lt;dbl&gt;,
#   marital_status &lt;chr&gt;, pregnant &lt;chr&gt;, language_english &lt;lgl&gt;,
#   household_income &lt;dbl&gt;, ur_albumin_ug_ml &lt;dbl&gt;, ur_albumin_mg_l &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Note that if there were observations in <code>labs_wide</code> that were not in <code>demographics</code>, then the resulting inner join will have fewer rows than both tables.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>